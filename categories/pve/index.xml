<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>PVE on 记录点滴 - 分享</title><link>https://www.iminling.com/categories/pve/</link><description>Recent content in PVE on 记录点滴 - 分享</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>iminling.com</copyright><lastBuildDate>Sun, 09 Feb 2025 03:15:47 +0000</lastBuildDate><atom:link href="https://www.iminling.com/categories/pve/index.xml" rel="self" type="application/rss+xml"/><item><title>Proxmox VE(PVE)8.0安装飞牛私有云fnOS – NAS</title><link>https://www.iminling.com/2025/install-fnos-nas/</link><pubDate>Sun, 09 Feb 2025 03:15:47 +0000</pubDate><guid>https://www.iminling.com/2025/install-fnos-nas/</guid><description>&lt;p>&lt;a class="link" href="https://www.fnnas.com" target="_blank" rel="noopener"
>飞牛nas&lt;/a>系统出来也有段时间了，一个很不错的nas系统，在以前的文章中也介绍过&lt;a class="link" href="https://www.iminling.com/2024/pve-install-nas" title="Proxmox VE(PVE)8.0安装黑群晖NAS并直通硬盘"
target="_blank" rel="noopener"
>群晖nas系统的安装&lt;/a>，今天就来一次尝鲜，安装一下fnOS，看一下群晖的系统和飞牛的系统有什么区别。接下来就开始安装折腾之路 - 飞牛私有云fnOS nas安装。&lt;/p>
&lt;h2 id="pve配置">PVE配置
&lt;/h2>&lt;p>首先要先去&lt;a class="link" href="https://www.fnnas.com/download" target="_blank" rel="noopener"
>飞牛官网&lt;/a>把官方镜像ISO文件给下载下来，上传到pve中，这个还有不清楚的可以参考&lt;a class="link" href="https://www.iminling.com/2024/pve-install-ikuai" title="Proxmox VE(PVE)8.0安装爱快ikuai虚拟机并直通网卡"
target="_blank" rel="noopener"
>Proxmox VE(PVE)8.0安装爱快ikuai虚拟机并直通网卡&lt;/a>中对爱快ISO文件上传的步骤。&lt;/p>
&lt;h3 id="常规">常规
&lt;/h3>&lt;p>修改为自己想要的vmid 以及 名称，我这里名称填了103，可以修改自己喜欢的，比如&lt;code>飞牛NAS&lt;/code>等。其他默认。&lt;/p>
&lt;p>[&lt;img src="https://images.iminling.com/i/2025/01/08/37837647596f9bb193eb5478ce1cde0f.webp"
loading="lazy"
alt="fnos common"
>][5]&lt;/p>
&lt;h3 id="操作系统">操作系统
&lt;/h3>&lt;p>操作系统选择在飞牛官网下载的iso文件。其他的默认&lt;/p>
&lt;p>[&lt;img src="https://images.iminling.com/i/2025/01/08/e4de0f82014a774996efa5f6568c0acf.webp"
loading="lazy"
alt="fnos os"
>][6]&lt;/p>
&lt;h3 id="系统">系统
&lt;/h3>&lt;p>机型这里选择q35，其他不变。&lt;/p>
&lt;p>[&lt;img src="https://images.iminling.com/i/2025/01/08/ffa5be3d705f4d6fae78b707bf0cc037.webp"
loading="lazy"
alt="fnos system"
>][7]&lt;/p>
&lt;h3 id="磁盘">磁盘
&lt;/h3>&lt;p>这里没有截图到，实际是和安装群群一样，把磁盘删除了，什么都不留。如果只是想体验则可以根据实际情况来分配硬盘大小。&lt;/p>
&lt;p>我这里是要把一个硬盘直通给飞牛的，所以我这里就把硬盘都给删除了 。&lt;/p>
&lt;p>如果只是用来体验，则可以给一个30G的磁盘。&lt;/p>
&lt;h3 id="cpu">cpu
&lt;/h3>&lt;p>cpu核心根据自己的情况来，我的J4125只有4个核心，所以全给了。类别选host。&lt;/p>
&lt;p>[&lt;img src="https://images.iminling.com/i/2025/01/08/e0272ce01b4a02382119f02e9df93e3e.webp"
loading="lazy"
alt="fnos cpu"
>][8]&lt;/p>
&lt;h3 id="内存配置">内存配置
&lt;/h3>&lt;p>内存根据自己的需求来给，建议2G以上，我这里给4G.&lt;/p>
&lt;p>[&lt;img src="https://images.iminling.com/i/2025/01/08/c2ec1daba8630f17c9a006afa1a9d040.webp"
loading="lazy"
alt="fnos ram"
>][9]&lt;/p>
&lt;h3 id="网络">网络
&lt;/h3>&lt;p>网络我这里直接默认，使用pve的网桥&lt;code>vmbr0&lt;/code>就可以了。&lt;/p>
&lt;p>[&lt;img src="https://images.iminling.com/i/2025/01/08/42a35339b69c2328ebeff937053706d2.webp"
loading="lazy"
alt="fnos network"
>][10]&lt;/p>
&lt;h3 id="确认">确认
&lt;/h3>&lt;p>都设置完成后对已设置的信息进行确认，基本不会有什么问题，完成。&lt;/p>
&lt;p>[&lt;img src="https://images.iminling.com/i/2025/01/08/c2f60e6ebc7d2de5314c6312dd7b1f52.webp"
loading="lazy"
alt="fnos confirm"
>][11]&lt;/p>
&lt;h3 id="硬盘直通">硬盘直通
&lt;/h3>&lt;p>经过上边设置后，需要再给nas系统一个磁盘，可以参考我在&lt;a class="link" href="https://www.iminling.com/2024/pve-install-nas" title="Proxmox VE(PVE)8.0安装黑群晖NAS并直通硬盘"
target="_blank" rel="noopener"
>Proxmox VE(PVE)8.0安装黑群晖NAS并直通硬盘&lt;/a>时的直通操作，基本是一样的。&lt;/p>
&lt;p>硬盘直通后，要看一下启动顺序，需要先从我们上传的iso镜像启动，如果没有问题就可以启动了。&lt;/p>
&lt;h2 id="fnos安装">FnOS安装
&lt;/h2>&lt;p>经过上边的步骤，已经创建好了一个虚拟机。接下来就是对系统进行配置启动了。点击控制台查看启动。默认图形安装。&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/366271dd2ffa0ef1821b8e3b86440a6c.webp"
loading="lazy"
alt="fnos boot"
>&lt;/p>
&lt;p>选择安装位置，本文这里是选择直通的硬盘：&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/e5ee329267cbe5bd4aae8fe6a258267a.webp"
loading="lazy"
alt="fnos disk select"
>&lt;/p>
&lt;p>下一步选择系统分区大小,官方默认给的是64G，这里直接按官方建议来：&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/226fe70c13e5ab86147589ed6746b766.webp"
loading="lazy"
alt="fnos system disk"
>&lt;/p>
&lt;p>接下来就是安装了，等待安装成功就可以了。&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/cf81cf188faa745ddfe2c241b150d05e.webp"
loading="lazy"
alt="fnos setup complete"
>&lt;/p>
&lt;p>下一步就会出现重启了，重启后控制台会显示一下内容：&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/a09fdf42f173d00e8a376c07e7bb4305.webp"
loading="lazy"
alt="fnos login"
>&lt;/p>
&lt;p>会告诉登录的ip和端口，这里是&lt;code>http://192.168.1.47:5666&lt;/code>,等下来浏览器直接输入这个地址来进行访问。&lt;/p>
&lt;h2 id="初始化fnos">初始化FnOS
&lt;/h2>&lt;h3 id="系统设置">系统设置
&lt;/h3>&lt;p>接下来对fnos进行初始化，访问上边的地址：&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/d3c94bd7539929c05abffe55a8295ea2.webp"
loading="lazy"
alt="fnos setup"
>&lt;/p>
&lt;p>初次进入后需要设置设备名称以及管理员信息。&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/e6061080b1049a0751792f173238d904.webp"
loading="lazy"
alt="fnos setting"
>&lt;/p>
&lt;h3 id="存储空间创建">存储空间创建
&lt;/h3>&lt;p>设置后会进入系统，因为是第一次进入系统，系统会提示创建存储空间：&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/b312decdfb16d2338ac395e0f5485d23.webp"
loading="lazy"
alt="fnos disk"
>&lt;/p>
&lt;p>点击立即创建，选择磁盘以及数据保护默认，我这里直接使用默认basic方式。&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/63391e0b3418e5fbf3be4f6819c88b68.webp"
loading="lazy"
alt="fnos disk select "
>&lt;/p>
&lt;p>下一步设置存储空间可以使用的用户以及可以使用的大小，我这里只有自己使用，容量不限制：&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/e10b83abed66f0285f19eb6dfb5f1a25.webp"
loading="lazy"
alt="fnos create disk"
>&lt;/p>
&lt;p>下一步创建确认：&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/b02e6bce0be8396b9d261a020abc8d5d.webp"
loading="lazy"
alt="fnos create confirm"
>&lt;/p>
&lt;p>对磁盘进行格式化：&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/d75627947bc95dadc91e27fe57914980.webp"
loading="lazy"
alt="fnos format disk"
>&lt;/p>
&lt;p>格式化完就创建成功了：&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/4488f9a7b2b8f817f1f48ef411064ae2.webp"
loading="lazy"
alt="fnos disk created"
>&lt;/p>
&lt;p>查看创建的存储空间：&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/i/2025/01/08/cd7395e330ccc57ac0fe7fc80a122fe6.webp"
loading="lazy"
alt="fnos disk"
>&lt;/p>
&lt;h3 id="fnos文件系统">FnOS文件系统
&lt;/h3>&lt;p>上边就已经完全安装好了飞牛NSA，飞牛的磁盘存储位置和群晖还是有一点不一样的，我们可以通过ssh登录进系统进行查看他的磁盘信息。&lt;/p>
&lt;p>ssh登录信息为访问网页版的用户名和密码。使用访问网页的ip和22端口+用户名和密码来进行登录。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">aa@FnOS:/$ df -h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Filesystem Size Used Avail Use% Mounted on
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">udev 1.9G 0 1.9G 0% /dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs 394M 7.7M 386M 2% /run
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/sda2 63G 9.1G 51G 16% /
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs 2.0G 1.4M 2.0G 1% /dev/shm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs 5.0M 0 5.0M 0% /run/lock
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">trimafs 1.8T 1.7T 58G 97% /fs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/dev/mapper/trim_f9cc7969_89e3_4c0b_9857_bcec3a1144d7-0 1.8T 1.7T 58G 97% /vol1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tmpfs 394M 0 394M 0% /run/user/1000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可以看到飞牛的系统是放在&lt;code>/&lt;/code>目录下的，63G, 而我直通的硬盘有两个目录&lt;code>/fs&lt;/code>和&lt;code>/vol1&lt;/code>。&lt;/p>
&lt;div data-page-id="SPIRdFXeFoo8mBxUJMgu3LHGsIe" data-lark-html-role="root" data-docx-has-block-data="false">
&lt;div class="ace-line ace-line old-record-id-YajHdl9ZxoJsJIxpfL0uECmrsrb">
在我的文件自己创建的目录在/fs目录下：
&lt;/div>
&lt;div>
```
aa@FnOS:/fs/1000/ftp$ ls
docker download
```
&lt;p>
直接使用应用商店安装的qb下载目录可以在qb的设置里看到，实际是在&lt;code>/vol1&lt;/code>下。&lt;/div>
&lt;div>
```
aa@FnOS:/var/apps/qBittorrent/shares$ ls -alh
total 8.0K
drwxr-xr-x 2 root root 4.0K Jan 7 23:05 .
drwxr-xr-x 6 root root 4.0K Jan 7 23:05 ..
lrwxrwxrwx 1 root root 27 Jan 7 23:05 qBittorrent -> /vol1/@appshare/qBittorrent
```
&lt;p>
其他的目录信息大家根据情况再去研究。
&lt;/p>
&lt;/div>
&lt;h3>
qb下载
&lt;/h3>
&lt;div>
默认qb只能访问安装后设置里配置的目录，如果想要改变qb下载的目录，则需要去&lt;code>系统设置-应用&lt;/code>找到qb，添加一下允许它访问的文件目录。
&lt;/div>&lt;/div>
&lt;p>
&lt;/p>
&lt;p>
下边是完整后的桌面预览图
&lt;/p>
&lt;p>
![fnos complete](https://images.iminling.com/i/2025/01/08/3b89be1091025e546acd4224064abb0a.webp)
&lt;/p></description></item><item><title>Proxmox VE(PVE)8.0使用CT模板创建LXC版docker服务</title><link>https://www.iminling.com/2024/pve-use-ct-template-install-lxc-docker/</link><pubDate>Wed, 27 Mar 2024 15:28:11 +0000</pubDate><guid>https://www.iminling.com/2024/pve-use-ct-template-install-lxc-docker/</guid><description>&lt;p>前边已经分享了&lt;a class="link" href="https://www.iminling.com/2024/03/23/459.html" title="畅网J4125安装Proxmox VE(PVE)8.0"
target="_blank" rel="noopener"
>pve的安装&lt;/a>，pve下&lt;a class="link" href="https://www.iminling.com/2024/03/24/480.html" title="Proxmox VE(PVE)8.0安装爱快ikuai虚拟机并直通网卡"
target="_blank" rel="noopener"
>安装爱快(ikuai)&lt;/a>以及pve下&lt;a class="link" href="https://www.iminling.com/2024/03/24/506.html" title="Proxmox VE(PVE)8.0安装Openwrt实现旁路由模式"
target="_blank" rel="noopener"
>安装openwrt&lt;/a>实现旁路由，还想要弄一个docker来跑一些其他的服务，docker的安装有两种方式，一种是装一个linux的虚拟机，然后在里边来跑docker,另一种就是今天要介绍的使用CT模板来创建LXC容器跑docker。&lt;/p>
&lt;h2 id="ct模板下载">CT模板下载
&lt;/h2>&lt;p>我这里使用的是debain12来当作模板，可以在pve里下载该模板。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/7E92FF62DB65F518A96602F5399B44F8.png"
loading="lazy"
alt="pve ct debain"
>&lt;/p>
&lt;h2 id="创建ct">创建CT
&lt;/h2>&lt;h3 id="常规">常规
&lt;/h3>&lt;p>点击&lt;code>创建CT&lt;/code>,这里的主机名随便给一个，因为我这里是要专门来运行docker,所以我这里填：docker, 密码是这个容器的登录密码，一定要牢记。&lt;strong>另外要把无特权的容器取消勾选&lt;/strong>。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/A59C08C68890457E48A611F260EE0AAB.png"
loading="lazy"
alt="pve ct docker common"
>&lt;/p>
&lt;h3 id="模板">模板
&lt;/h3>&lt;p>模板选择下载的debian模板&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/64903720B307C55D2EDE57D31A257AEC.png"
loading="lazy"
alt="pve ct docker template"
>&lt;/p>
&lt;h3 id="磁盘">磁盘
&lt;/h3>&lt;p>磁盘大小根据自己的实际需要给&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/BE6319C63E45A2E647B33499D7EE94D6.png"
loading="lazy"
alt="pve ct docker disk"
>&lt;/p>
&lt;h3 id="cpu">CPU
&lt;/h3>&lt;p>cpu把j4125的4核都给过去&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/EA0406A5D024B0A4FB377E63F01993B7.png"
loading="lazy"
alt="pve ct docker cpu"
>&lt;/p>
&lt;h3 id="内存">内存
&lt;/h3>&lt;p>我这里先给2GB，后续根据需求再添加&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/90DC6043C619243EBE3F0AB48A9015AD.png"
loading="lazy"
alt="pve ct docker ram"
>&lt;/p>
&lt;h3 id="网络">网络
&lt;/h3>&lt;p>我这里手动指定了ip，可以使用dhcp自动分配ip&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/91E1F0C50CC80365DAD6B7A22C1EB17F.png"
loading="lazy"
alt="pve ct docker network"
>&lt;/p>
&lt;h3 id="dns">DNS
&lt;/h3>&lt;p>dns默认&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/DB074575B8092E3523636E4BBDE443B0.png"
loading="lazy"
alt="pve ct docker dns"
>&lt;/p>
&lt;h3 id="确认">确认
&lt;/h3>&lt;p>刚才设置的一些信息的预览&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/214E2A31E399F754F2DB04C2A57BFBED.png"
loading="lazy"
alt="pve ct docker confirm"
>&lt;/p>
&lt;p>创建完成后先不要开机，还需要一些其他的一些配置。&lt;/p>
&lt;h3 id="功能">功能
&lt;/h3>&lt;p>在功能里勾选NFS等选项&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/AAE848B3187FBB8E0F1A8F2DF763C112.png"
loading="lazy"
alt="pve ct docker function"
>&lt;/p>
&lt;h3 id="lxc配置文件">LXC配置文件
&lt;/h3>&lt;p>还需要进入pve的shell,对刚创建的LXC容器的配置文件进行修改，位置：/etc/pve/lxc,此时里边应该只有1个配置文件，文件名对应创建的lxc容器在pve里的id。我的是102.conf&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>需要在后边再添加几行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">lxc.apparmor.profile: unconfined # 表示容器内的进程将不受任何 AppArmor 限制
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.auto: cgroup:rw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.auto: proc:rw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.auto: sys:rw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cap.drop: # 用于指定容器内进程的能力限制，允许进程执行一些特定的操作，例如修改系统时间、挂载文件系统等
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cgroup.devices.allow: a
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>完整的配置如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@pve:/etc/pve/lxc# cat 102.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">arch: amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cores: 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">features: fuse=1,mount=nfs;cifs,nesting=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hostname: docker
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">memory: 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net0: name=eth0,bridge=vmbr0,firewall=1,gw=192.168.1.253,hwaddr=BA:64:EF:29:04:A6,ip=192.168.1.22/24,type=veth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ostype: debian
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rootfs: local-lvm:vm-102-disk-0,size=30G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">swap: 512
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.apparmor.profile: unconfined
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.auto: cgroup:rw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.auto: proc:rw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.mount.auto: sys:rw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cap.drop:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lxc.cgroup.devices.allow: a
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>配置完成后就可以正常启动该容器了。&lt;/p>
&lt;h2 id="更换源">更换源
&lt;/h2>&lt;p>源文件路径：&lt;code>/etc/apt/sources.list&lt;/code>,替换为下边的内容。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@docker:/etc/apt# cat sources.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb https://mirrors.ustc.edu.cn/debian bookworm main contrib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb https://mirrors.ustc.edu.cn/debian bookworm-updates main contrib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb https://mirrors.ustc.edu.cn/debian-security bookworm-security main contrib
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看是否替换成功，执行命令apt update:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">apt&lt;/span>&lt;span class="c1"># apt update&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Hit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">mirrors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ustc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">edu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">debian&lt;/span> &lt;span class="n">bookworm&lt;/span> &lt;span class="n">InRelease&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Get&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">mirrors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ustc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">edu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">debian&lt;/span> &lt;span class="n">bookworm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">updates&lt;/span> &lt;span class="n">InRelease&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mf">55.4&lt;/span> &lt;span class="n">kB&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Get&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">mirrors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ustc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">edu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">security&lt;/span> &lt;span class="n">bookworm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">security&lt;/span> &lt;span class="n">InRelease&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mf">48.0&lt;/span> &lt;span class="n">kB&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Get&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">4&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">mirrors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ustc&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">edu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">debian&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">security&lt;/span> &lt;span class="n">bookworm&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">security&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">main&lt;/span> &lt;span class="n">amd64&lt;/span> &lt;span class="n">Packages&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">148&lt;/span> &lt;span class="n">kB&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Hit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">5&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">docker&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">linux&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">debian&lt;/span> &lt;span class="n">bookworm&lt;/span> &lt;span class="n">InRelease&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Fetched&lt;/span> &lt;span class="mi">251&lt;/span> &lt;span class="n">kB&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">228&lt;/span> &lt;span class="n">kB&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Reading&lt;/span> &lt;span class="n">package&lt;/span> &lt;span class="n">lists&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="n">Done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Building&lt;/span> &lt;span class="n">dependency&lt;/span> &lt;span class="n">tree&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="n">Done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Reading&lt;/span> &lt;span class="n">state&lt;/span> &lt;span class="n">information&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="n">Done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">51&lt;/span> &lt;span class="n">packages&lt;/span> &lt;span class="n">can&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">upgraded&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Run&lt;/span> &lt;span class="s1">&amp;#39;apt list --upgradable&amp;#39;&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">see&lt;/span> &lt;span class="n">them&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可见已经替换成功。&lt;/p>
&lt;h2 id="ssh登录">SSH登录
&lt;/h2>&lt;p>默认情况下只能通过pve的控制台进行登录，无法在其他地方进行登录。&lt;/p>
&lt;p>修改sshd的配置文件，文件路径：/etc/ssh/sshd_config,添加下边的内容：允许root登录，开启key登录：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">PermitRootLogin yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PubkeyAuthentication yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AuthorizedKeysFile .ssh/authorized_keys
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果只想使用key登录，禁止密码登录可以再添加一行：&lt;code>PasswordAuthentication no&lt;/code> 。根据自己需求添加。&lt;/p>
&lt;h2 id="时区设置">时区设置
&lt;/h2>&lt;p>默认情况下是0时区：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@docker:~# date
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sun Mar 24 07:04:09 UTC 2024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@docker:~# date -R
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sun, 24 Mar 2024 07:04:11 +0000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改为北京时间：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@docker:~# timedatectl set-timezone Asia/Shanghai
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@docker:~# timedatectl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local time: Sun 2024-03-24 15:06:22 CST
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Universal time: Sun 2024-03-24 07:06:22 UTC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RTC time: n/a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Time zone: Asia/Shanghai (CST, +0800)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">System clock synchronized: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> NTP service: inactive
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RTC in local TZ: no
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可以看到已成功设置为北京时间了。&lt;/p>
&lt;p>整个LXC容器已设置完成。&lt;/p></description></item><item><title>Proxmox VE(PVE)8.0换中科大源</title><link>https://www.iminling.com/2024/pve-change-ustc-source/</link><pubDate>Tue, 26 Mar 2024 23:45:43 +0000</pubDate><guid>https://www.iminling.com/2024/pve-change-ustc-source/</guid><description>&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/B42FD7FF691A2DA49E72BE3C533CF000.webp"
loading="lazy"
>&lt;/p>
&lt;p>前边介绍了&lt;a class="link" href="https://www.iminling.com/2024/03/23/459.html" title="畅网J4125安装Proxmox VE(PVE)8.0"
target="_blank" rel="noopener"
>PVE的安装&lt;/a>，Proxmox VE(PVE)8.0的底层使用的是debian12，默认的源在国外下载速度非常慢，甚至可能连接失败，所以需要更换一下默认源为&lt;a class="link" href="https://mirrors.ustc.edu.cn/" target="_blank" rel="noopener"
>中科大的源&lt;/a>来加快下载以及更新软件的速度。&lt;/p>
&lt;h2 id="apt源">APT源
&lt;/h2>&lt;p>需要修改三个文件&lt;/p>
&lt;h3 id="sourceslist">sources.list
&lt;/h3>&lt;p>位置在/etc/apt/sources.list,这个文件里默认有三行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@pve:~# cat /etc/apt/sources.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://ftp.debian.org/debian bookworm main contrib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://ftp.debian.org/debian bookworm-updates main contrib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># security updates
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb http://security.debian.org bookworm-security main contrib
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>替换为一下三条：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@pve:~# cat /etc/apt/sources.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#deb http://ftp.debian.org/debian bookworm main contrib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb https://mirrors.ustc.edu.cn/debian bookworm main contrib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#deb http://ftp.debian.org/debian bookworm-updates main contrib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb https://mirrors.ustc.edu.cn/debian bookworm-updates main contrib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># security updates
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#deb http://security.debian.org bookworm-security main contrib
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb https://mirrors.ustc.edu.cn/debian-security bookworm-security main contrib
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或使用一键命令进行替换：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sed -i &amp;#39;s|^deb http://ftp.debian.org|deb https://mirrors.ustc.edu.cn|g&amp;#39; /etc/apt/sources.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sed -i &amp;#39;s|^deb http://security.debian.org|deb https://mirrors.ustc.edu.cn/debian-security|g&amp;#39; /etc/apt/sources.list
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>最主要的就是 &lt;code>http://ftp.debain.org&lt;/code>  替换为 &lt;code>https://mirrors.ustc.edu.cn&lt;/code>  ,  &lt;code>http://security.debian.org&lt;/code>  替换为 &lt;code>https://mirrors.ustc.edu.cn/debian-security&lt;/code>  。&lt;/p>
&lt;h3 id="cephlist">ceph.list
&lt;/h3>&lt;p>位置：&lt;code>/etc/apt/sources.list.d/ceph.list&lt;/code>,原始内容如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@pve:~# cat /etc/apt/sources.list.d/ceph.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb https://enterprise.proxmox.com/debian/ceph-quincy bookworm enterprise
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>替换为：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@pve:~# cat /etc/apt/sources.list.d/ceph.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#deb https://enterprise.proxmox.com/debian/ceph-quincy bookworm enterprise
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb https://mirrors.ustc.edu.cn/proxmox/debian/ceph-quincy bookworm no-subscription
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>替换完成。&lt;/p>
&lt;h3 id="pve-enterprise-list">pve-enterprise.list
&lt;/h3>&lt;p>位置是：&lt;code>/etc/apt/sources.list.d/pve-enterprise.list&lt;/code>,这个是pve企业的源，没有订阅pve也就没什么用，直接把这个文件里的内容注释了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@pve:~# cat /etc/apt/sources.list.d/pve-enterprise.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#deb https://enterprise.proxmox.com/debian/pve bookworm pve-enterprise
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>到这里apt的源就替换完成了，可以执行apt udpate来看一下是否更换成功。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="nx">pve&lt;/span>&lt;span class="p">:~&lt;/span>&lt;span class="err">#&lt;/span> &lt;span class="nx">apt&lt;/span> &lt;span class="nx">update&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Hit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="nx">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="c1">//mirrors.ustc.edu.cn/debian bookworm InRelease&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Get&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="nx">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="c1">//mirrors.ustc.edu.cn/debian bookworm-updates InRelease [55.4 kB]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Get&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3&lt;/span> &lt;span class="nx">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="c1">//mirrors.ustc.edu.cn/debian-security bookworm-security InRelease [48.0 kB]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Hit&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">4&lt;/span> &lt;span class="nx">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="c1">//mirrors.ustc.edu.cn/proxmox/debian/ceph-quincy bookworm InRelease&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Get&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">5&lt;/span> &lt;span class="nx">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="c1">//mirrors.ustc.edu.cn/debian-security bookworm-security/main amd64 Packages [148 kB]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Fetched&lt;/span> &lt;span class="mi">251&lt;/span> &lt;span class="nx">kB&lt;/span> &lt;span class="nx">in&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="nf">s&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">300&lt;/span> &lt;span class="nx">kB&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Reading&lt;/span> &lt;span class="kn">package&lt;/span> &lt;span class="nx">lists&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="nx">Done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Building&lt;/span> &lt;span class="nx">dependency&lt;/span> &lt;span class="nx">tree&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="nx">Done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Reading&lt;/span> &lt;span class="nx">state&lt;/span> &lt;span class="nx">information&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="nx">Done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">94&lt;/span> &lt;span class="nx">packages&lt;/span> &lt;span class="nx">can&lt;/span> &lt;span class="nx">be&lt;/span> &lt;span class="nx">upgraded&lt;/span>&lt;span class="p">.&lt;/span> &lt;span class="nx">Run&lt;/span> &lt;span class="err">&amp;#39;&lt;/span>&lt;span class="nx">apt&lt;/span> &lt;span class="nx">list&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="nx">upgradable&lt;/span>&lt;span class="err">&amp;#39;&lt;/span> &lt;span class="nx">to&lt;/span> &lt;span class="nx">see&lt;/span> &lt;span class="nx">them&lt;/span>&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>已经使用了中科大的源了，替换成功。&lt;/p>
&lt;h2 id="ct模板源">CT模板源
&lt;/h2>&lt;p>文件位置：&lt;code>/usr/share/perl5/PVE/APLInfo.pm&lt;/code>，需要替换 &lt;code>http://download.proxmox.com&lt;/code>  为 &lt;code>https://mirrors.ustc.edu.cn/proxmox&lt;/code>,可以执行命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sed&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="s1">&amp;#39;s|http://download.proxmox.com|https://mirrors.ustc.edu.cn/proxmox|g&amp;#39;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="n">usr&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">share&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">perl5&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">PVE&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">APLInfo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pm&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或者通过直接修改APLInfo.pm的内容进行修改，替换后的内容如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">my&lt;/span> &lt;span class="o">$&lt;/span>&lt;span class="n">sources&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">host&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s2">&amp;#34;download.proxmox.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s2">&amp;#34;https://mirrors.ustc.edu.cn/proxmox/images&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="s1">&amp;#39;aplinfo-pve-8.dat&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>保存后进行重启pvedaemon：&lt;code>systemctl restart pvedaemon.service&lt;/code> 。&lt;/p>
&lt;p>整个pve的源就替换完成了。&lt;/p></description></item><item><title>Proxmox VE(PVE)8.0无法访问网络排查</title><link>https://www.iminling.com/2024/pve-network-troubleshooting/</link><pubDate>Tue, 26 Mar 2024 05:34:09 +0000</pubDate><guid>https://www.iminling.com/2024/pve-network-troubleshooting/</guid><description>&lt;p>前边介绍了&lt;a class="link" href="https://www.iminling.com/2024/03/23/459.html" title="畅网J4125安装Proxmox virtual environment(pve) 8.0"
target="_blank" rel="noopener"
>Proxmox VE(PVE)的安装&lt;/a>，一直也没有在pve中进行过联网动作，直到今天想要在pve中运行LXC容器，需要下载CT模板的时候才发现原来pve是无法联网的，于是又开始了折腾pve的网络了。&lt;/p>
&lt;h2 id="情况说明">情况说明
&lt;/h2>&lt;p>在我下载CT模板的时候模板列表是能出来的，但是当点击下载后，等待一段时间后就提示无法下载，但是那个地址我直接在浏览器中访问是可以的。在pve的shell中ping一些地址提示：Destination Host Unreachable，如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@pve:~# ping 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">From 192.168.1.251 icmp_seq=1 Destination Host Unreachable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">From 192.168.1.251 icmp_seq=2 Destination Host Unreachable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">From 192.168.1.251 icmp_seq=3 Destination Host Unreachable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">From 192.168.1.251 icmp_seq=4 Destination Host Unreachable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">^C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--- 1.1.1.1 ping statistics ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5 packets transmitted, 0 received, +4 errors, 100% packet loss, time 4065ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pipe 4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>但是ping内网的网段是完全ok的，可见是内网通，只是无法连接到互联网。&lt;/p>
&lt;h2 id="问题分析">问题分析
&lt;/h2>&lt;p>在遇到上边问题后，我也上网找了一些解决办法，大部分都是说DNS服务器设置的不对，第一个为lan，第二个为阿里的dns服务器，第三个为爱快(ikuai)的地址，这样子设置后发现还是同样的问题。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/EB7A04F12FB94485C93870ECAFD3A4C9.png"
loading="lazy"
alt="pve dns"
>&lt;/p>
&lt;p>后来在网络配置中发现了问题，这里的网关我配置的是192.168.1.1。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/B42FD7FF691A2DA49E72BE3C533CFE1E.png"
loading="lazy"
alt="pve network"
>&lt;/p>
&lt;p>当时安装pve的时候在规划网络时填的是192.168.1.1，但是当安装完pve，进行ikuai配置的时候我改变了注意，把ikuai的地址分配为192.168.1.253，所以导致192.168.1.1其实并没有设备使用，导致pve无法访问网络。&lt;/p>
&lt;h2 id="问题解决">问题解决
&lt;/h2>&lt;p>既然找到了问题，那就修改一下试一试，于是对pve的网关配置进行修改，把网关地址设置为爱快(ikuai)的地址：&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/AC7CCDE1F9D6DDE1321A91A1B013DC38.png"
loading="lazy"
alt="pve network gateway"
>&lt;/p>
&lt;p>再去pve中进行ping检测，发现已经可以通了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@pve:~# ping 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">64 bytes from 1.1.1.1: icmp_seq=1 ttl=54 time=152 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">64 bytes from 1.1.1.1: icmp_seq=2 ttl=54 time=164 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">64 bytes from 1.1.1.1: icmp_seq=3 ttl=54 time=166 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">^C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--- 1.1.1.1 ping statistics ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3 packets transmitted, 3 received, 0% packet loss, time 2002ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rtt min/avg/max/mdev = 151.887/160.656/165.863/6.236 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@pve:~#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>成功的解决了pve无法联网的问题。&lt;/p></description></item><item><title>Proxmox VE(PVE)8.0安装Openwrt实现旁路由模式</title><link>https://www.iminling.com/2024/pve-install-openwrt/</link><pubDate>Sun, 24 Mar 2024 05:43:31 +0000</pubDate><guid>https://www.iminling.com/2024/pve-install-openwrt/</guid><description>&lt;p>在前两篇文章中分别介绍了&lt;a class="link" href="https://www.iminling.com/2024/03/23/459.html" title="畅网J4125安装Proxmox virtual environment(pve) 8.0"
target="_blank" rel="noopener"
>pve的安装&lt;/a>以及pve安装ikuai做为主路由来拨号上网，此时的网络环境基本已经稳定，但出于特殊需求，我需要使用Openwrt来进行科学上网，所以今天就来折腾一下pve安装Openwrt并实现旁路由模式。&lt;/p>
&lt;h2 id="openwrt镜像">openwrt镜像
&lt;/h2>&lt;p>我使用的是&lt;a class="link" href="https://github.com/DHDAXCW/OpenWRT_x86_x64/releases" target="_blank" rel="noopener"
>骷髅头的openwrt&lt;/a>镜像，下载的是beggar版本，可根据自己的需求找不同的openwrt版本。下载完成后需要对文件进行解压，下载下来的是&lt;code>.gz&lt;/code>结尾的文件，需要解压成&lt;code>.img&lt;/code>结尾的文件，解压后上传到pve中&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/BC97614C54342FD608F4DC6371CAC5A2.png"
loading="lazy"
alt="upload iso"
>&lt;/p>
&lt;h2 id="创建">创建
&lt;/h2>&lt;h3 id="常规">常规
&lt;/h3>&lt;p>vm ID默认自增到101(ikuai是100)，名称自己填，我这里填openwrt&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/530BCC51DD19D59BD1FE510D32076904.png"
loading="lazy"
alt="pve openwrt common"
>&lt;/p>
&lt;h3 id="操作系统">操作系统
&lt;/h3>&lt;p>选择不使用任何介质&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/C8D5A323386C9A1DE5B0BB9BE0386666.png"
loading="lazy"
alt="pve openwrt os"
>&lt;/p>
&lt;h3 id="系统">系统
&lt;/h3>&lt;p>全部默认就可以了&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/E821D7E134B98F154E16F7EAC211E8C8.png"
loading="lazy"
alt="pve openwrt os"
>&lt;/p>
&lt;h3 id="磁盘">磁盘
&lt;/h3>&lt;p>这里保持默认，后边会进行删除。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/A26DDB4E4114936B881254ED7A0DF2B1.png"
loading="lazy"
alt="pve openwrt disk"
>&lt;/p>
&lt;h3 id="cpu">CPU
&lt;/h3>&lt;p>同样把j4125的四个核心都给到它&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/837D4B78C94107F0889EC9C53103D241.png"
loading="lazy"
alt="pve openwrt cpu"
>&lt;/p>
&lt;h3 id="内存">内存
&lt;/h3>&lt;p>运行openwrt,1GB的RAM就够用了。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/A7271E4BAEB3BEFE01324962F694F811.png"
loading="lazy"
alt="pve openwrt ram"
>&lt;/p>
&lt;h3 id="网络">网络
&lt;/h3>&lt;p>全部默认&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/5A90B845671AC32312801582885D4C09.png"
loading="lazy"
alt="pve openwrt network"
>&lt;/p>
&lt;h3 id="确认">确认
&lt;/h3>&lt;p>确认所有选项是否正确。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/87FEC65DDEE9CF8BB85FFFFF5B6D8C10.png"
loading="lazy"
alt="pve openwrt summary"
>&lt;/p>
&lt;p>没有问题就点完成。&lt;/p>
&lt;h2 id="硬件配置">硬件配置
&lt;/h2>&lt;p>创建过程中选择的硬盘是需要删除的，所以需要对硬件进行一些配置。&lt;/p>
&lt;h3 id="移除cd">移除CD
&lt;/h3>&lt;p>在硬件配置中将已存在的CD/DVD驱动器移除&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/81E209EBFF4348F0AE3B4E54454553D6.png"
loading="lazy"
alt="pve openwrt remove cd"
>&lt;/p>
&lt;h3 id="分离并移除硬盘">分离并移除硬盘
&lt;/h3>&lt;p>选中硬盘，先进行分离，然后进行移除。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/5894F46E2E267BC2B2E470D46D4C1CE0.png"
loading="lazy"
alt="pve openwrt remove disk"
>&lt;/p>
&lt;p>移除&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/F613F961817AF86518ABE38F0FC5C596.png"
loading="lazy"
alt="pve openwrt remove disk"
>&lt;/p>
&lt;h2 id="添加磁盘">添加磁盘
&lt;/h2>&lt;p>需要通过进入&lt;code>pve的shell&lt;/code>执行命令来导入磁盘,执行命令&lt;code>qm importdisk 虚拟主机编号 /var/lib/vz/template/iso/openwrt镜像名 local-lvm&lt;/code> ，虚拟主机编号是在经过上边创建虚拟机后pve生成的一个编号，例如我的是101，openwrt镜像名是在刚开始的时候上传到pve中的名称，我的名称是：openwrt.img. 替换后的命令如下：&lt;code>qm importdisk 101 /var/lib/vz/template/iso/openwrt.img local-lvm&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/CC7BD8ADEB55C47A3D661F37295D1213.png"
loading="lazy"
alt="pve openwrt importdisk"
>&lt;/p>
&lt;p>执行成功后会在硬件中看到一个未使用的磁盘，进行添加。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/3B19CC29E51F0933E2F10FCE711C62B4.png"
loading="lazy"
alt="pve openwrt importdisk"
>&lt;/p>
&lt;h3 id="引导顺序">引导顺序
&lt;/h3>&lt;p>磁盘添加后需要修改引导为当前的磁盘&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/3B9F70D8EF2F373E80CB1162B86C7A3E.png"
loading="lazy"
alt="pve openwrt boot sort"
>&lt;/p>
&lt;p>经过上边的设置就已经完全ok了，可以来启动openwrt了。&lt;/p>
&lt;h2 id="openwrt设置">openwrt设置
&lt;/h2>&lt;p>启动openwrt虚拟机，如下会卡住，敲回车就可以进行下去&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/2651DCA4CAEAB2FC8C5B7552D7AFD17B.png"
loading="lazy"
alt="pve openwrt boot"
>&lt;/p>
&lt;p>回车后如下图，表示启动成功&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/3C4703FF7B2FFF4B2100411200448BCA.png"
loading="lazy"
alt="pve openwrt"
>&lt;/p>
&lt;h3 id="设置ip">设置ip
&lt;/h3>&lt;p>一般固件都有自己的管理ip，可能和我们自己的网络不是在同一个网段，比如我下载这个默认的管理网段是192.168.6.1，我需要改成和我的网络在同一个网段，192.168.1.xxx。&lt;/p>
&lt;p>编辑 /etc/config/network，修改如下：&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/30305231BD4E418E530C4EFB1F2D2B2F.png"
loading="lazy"
alt="pve openwrt ip"
>&lt;/p>
&lt;p>我这里改成192.168.1.254，修改保存后重启openwrt,重启后就可以通过访问192.168.1.254在浏览器中进行相关配置了。&lt;/p>
&lt;h3 id="lan口设置">LAN口设置
&lt;/h3>&lt;p>进入openwrt系统后，首先是对网络接口LAN口进行设置，设置网关为爱快(ikuai)的管理地址，并关闭LAN口的DHCP功能&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/7F71B9608FB1F3EC02023B3A60FDCD08.png"
loading="lazy"
alt="pve openwrt lan"
>&lt;/p>
&lt;p>修改网关&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/0DC12C48DA49DFC3761270F7C1647457.png"
loading="lazy"
alt="pve openwrt gateway"
>&lt;/p>
&lt;p>这里需要注意一点，我在刚开始设置的时候并没有设置&lt;code>使用自定义DNS服务器&lt;/code>，后边发现openwrt无法上网，最终是填写了一个DNS服务器后才解决的，这里可以使用223.5.5.5或者其他的DNS服务器。&lt;/p>
&lt;h3 id="关闭防火墙">关闭防火墙
&lt;/h3>&lt;p>接下来关闭openwrt的防火墙&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/FD8C04F7DB94CBB12DB8675733828FDA.png"
loading="lazy"
alt="pve openwrt firewall"
>&lt;/p>
&lt;h3 id="upnp">UPNP
&lt;/h3>&lt;p>开启UPNP&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/A69A4758D6648D6D3977B0F2A9552B54.png"
loading="lazy"
alt="pve openwrt upnp"
>&lt;/p>
&lt;p>经过上边的设置，openwrt基本已设置完毕，可以开始使用了。&lt;/p>
&lt;h2 id="旁路由模式">旁路由模式
&lt;/h2>&lt;p>openwrt做为旁路由，该怎么工作呢，在ikuai设置的时候我设置了31-250的一个DHCP网络段，他们只会经过ikuai来处理流量，那什么设备可以经过这个openwrt旁路由呢？这里就需要在ikuai中进行一些设置了，同样是DHCP服务,我设置了10-30这个ip段的ip的网关为&lt;code>192.168.1.254&lt;/code>也就是openwrt的ip，那么这个ip段里的设置的网络就会经过openwrt来处理，满足特定需求了。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/213157C522C8091C348D788D4777FDE0.png"
loading="lazy"
alt="pve openwrt ikuai"
>&lt;/p>
&lt;p>因为我是先设置的31-250这个ip段，所以连接上来的设置被优先往这个ip段分配，自己的其他设置如果想要使用openwrt来处理流量，则对特定设置固定ip就可以了，设置他们的ip在10-30之间。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/5B2B6D7B677CDC4C07E01EC2ADB813F4.png"
loading="lazy"
alt="pve ikuai dhcp"
>&lt;/p>
&lt;p>大功告成，使用pve安装ikuai并使用openwrt做为旁路由。&lt;/p></description></item><item><title>Proxmox VE(PVE)8.0安装爱快ikuai虚拟机并直通网卡</title><link>https://www.iminling.com/2024/pve-install-ikuai/</link><pubDate>Sun, 24 Mar 2024 04:02:02 +0000</pubDate><guid>https://www.iminling.com/2024/pve-install-ikuai/</guid><description>&lt;p>上一篇介绍了在J4125机器上安装pve环境，安装好pve后整个机器还是无法上网的状态，所以接下来就来介绍一下在pve中安装爱快，使用爱快(ikuai)来进行拨号上网，当然也可以直接安装openwrt,出于综合考虑我这里还是安装爱快(ikuai)，会稳定一些，后续再折腾其他的也不影响家人上网。&lt;/p>
&lt;h2 id="爱快ikuai固件">爱快(ikuai)固件
&lt;/h2>&lt;p>爱快(ikuai)的固件也不大，直接&lt;a class="link" href="https://www.ikuai8.com/component/download" target="_blank" rel="noopener"
>官网&lt;/a>下载就可以了，下载ISO 64位的镜像。把下载的镜像上传到pve中&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/BC97614C54342FD608F4DC6371CAC5A2.png"
loading="lazy"
alt="upload iso"
>&lt;/p>
&lt;h2 id="创建ikuai虚拟机">创建ikuai虚拟机
&lt;/h2>&lt;p>鼠标右键点击pve选择创建虚拟机：&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/AB41ED7FE57F77EBE2A7CC399EBDAC49.png"
loading="lazy"
alt="create vm"
>&lt;/p>
&lt;h3 id="常规">常规
&lt;/h3>&lt;p>名称命名为ikuai，其他默认&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/37C50635EADEB66E0F50391CFFF4E607.png"
loading="lazy"
alt="ikuai common"
>&lt;/p>
&lt;h3 id="操作系统">操作系统
&lt;/h3>&lt;p>ISO镜像选择上传的爱快镜像：&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/2000A752149251377A7E236B43A53685.png"
loading="lazy"
alt="ikuai os"
>&lt;/p>
&lt;h3 id="系统">系统
&lt;/h3>&lt;p>保持默认继续下一步&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/A902C31B27FC063D4011BC60D9D61B9D.png"
loading="lazy"
alt="ikuai os"
>&lt;/p>
&lt;h3 id="磁盘">磁盘
&lt;/h3>&lt;p>ikuai我不做其他用处，所以这里给5GB硬盘&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/9B5DEEC9E17C047DDD48F1EB5D333094.png"
loading="lazy"
alt="ikuai disk"
>&lt;/p>
&lt;h3 id="cpu">CPU
&lt;/h3>&lt;p>cpu把j4125的四个核心都给它&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/EE54A081D9E2211E67F697AA788E00D2.png"
loading="lazy"
alt="ikuai core"
>&lt;/p>
&lt;h3 id="内存">内存
&lt;/h3>&lt;p>我这里给2GB的内存&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/844F8B73FDB622462F1AE20D96CC584A.png"
loading="lazy"
alt="ikuai ram"
>&lt;/p>
&lt;h3 id="网络">网络
&lt;/h3>&lt;p>默认&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/62A58B9B7D3AFB4EAC410515596F963E.png"
loading="lazy"
alt="ikuai network"
>&lt;/p>
&lt;h3 id="确认">确认
&lt;/h3>&lt;p>显示ikuai虚拟机的一些信息，确认和我们选择的是否一致&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/E2EF4664FA052E1AFCCD8A8B56D4BDAB.png"
loading="lazy"
alt="ikuai summary"
>&lt;/p>
&lt;p>一些基本信息就已经完成了。&lt;/p>
&lt;h2 id="添加直通网口">添加直通网口
&lt;/h2>&lt;p>在&lt;a class="link" href="https://www.iminling.com/2024/03/23/459.html" title="畅网J4125安装Proxmox8.0"
target="_blank" rel="noopener"
>畅网J4125安装pve 8.0&lt;/a>一 篇中已经规划了ETH3归为pve的管理口，那么剩下的三个网口都直通给ikuai,让ikuai来管理,选择硬件，然后点击添加，PCI设备，就会弹出下图：&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/5FDA72A183F9D81807117C2A397A2B86.png"
loading="lazy"
alt="ikuai interface"
>&lt;/p>
&lt;p>可以看到总共有4个I226-V的网口，04已经被pve管理口使用了，那么可以把01，02，03分别添加到硬件中。&lt;/p>
&lt;h2 id="设置引导项">设置引导项
&lt;/h2>&lt;p>默认优先是从添加的硬盘启动，因为是第一次启动硬盘里还没有数据，所以需要先从上传的ISO文件引导启动，修改启动项为ISO文件&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/A0313AD16FD54168A7C89025AA6AA4BF.png"
loading="lazy"
alt="ikuai引导"
>&lt;/p>
&lt;h2 id="安装">安装
&lt;/h2>&lt;p>经过上边的设置，下边就可以来真正的安装，点击启动&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/A78BA1A00FD69091B9137CA1B519E240.png"
loading="lazy"
alt="ikuai install"
>&lt;/p>
&lt;p>选择1安装到硬盘，安装成功后就会自动重启。重启后先关闭虚拟机，因为启动项问题 还是从镜像启动的，所以先关机 然后去调整启动项为硬盘&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/B2891BA68D272DC4F94F7F975F545C1E.png"
loading="lazy"
alt="ikuai boot"
>&lt;/p>
&lt;p>调整完成后就可以再次启动ikuai虚拟机了。&lt;/p>
&lt;h3 id="设置lan">设置LAN
&lt;/h3>&lt;p>看到下图说明ikuai已经安装并启动成功了&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/96E78C61B9C7CAA22C471057C8020643.png"
loading="lazy"
alt="ikuai"
>&lt;/p>
&lt;p>可以看到上图里有四个网口，eth0-eth3,其中eth0是pve一个虚拟网口，是ikuai的管理网口，其他三个网口是直通的三个PIC网口设备，后边进入ikuai设置界面后会把eth1设置为wan口，用来连接光猫拨号使用。&lt;/p>
&lt;p>选择2设置LAN,我规划的ikuai的管理地址是192.168.1.253&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/DE6C391418B396B32F9CCF2605DEF430.png"
loading="lazy"
alt="ikuai lan"
>&lt;/p>
&lt;p>设置成功后就可以不用再理pve了，此时可以通过网页进入ikuai的管理页面，浏览器直接访问192.168.1.253(这个根据自己设置的lan地址来进入)，密码都是admin/admin。初次登录会让改密码，修改为自己常用的密码。&lt;/p>
&lt;h3 id="配置wan">配置WAN
&lt;/h3>&lt;p>进入管理页面后会看到WAN口有异常，先配置WAN口&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/4B47574A0DB86053168EBC355DBAD3E9.png"
loading="lazy"
alt="ikuai index"
>&lt;/p>
&lt;p>绑定wan并设置pppoe拨号上网：&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/5AF13981CE3B311EC64240ABD76943F6.png"
loading="lazy"
alt="ikuai wan"
>&lt;/p>
&lt;p>设置好WAN后，此时还没有把WAN口和光猫连在一起，网络还是不行，我们先完成一些其他的配置项。&lt;/p>
&lt;h3 id="配置lan">配置LAN
&lt;/h3>&lt;p>将直通给爱快的其他两个口分配给lan&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/5DEDA518AF9ED1A4806E37EC47BD7CC5.png"
loading="lazy"
alt="ikuai lan"
>&lt;/p>
&lt;h3 id="dhcp配置">DHCP配置
&lt;/h3>&lt;p>对连接上来的设备进行ip地址自动分配&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/A081CFBD137F8CB96187484360AF97E7.png"
loading="lazy"
alt="ikuai dhcp"
>&lt;/p>
&lt;p>添加一条新的dhcp配置,我这里预留一些ip给自己使用，所以分配的ip是从31到250。&lt;/p>
&lt;p>网关：设置为ikuai自己的ip&lt;/p>
&lt;p>DNS：设置了一个阿里的和一个114的。&lt;/p>
&lt;p>其他默认就好。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/98C1F01FB70729ADC48497586250F8CD.png"
loading="lazy"
alt="ikuai dhcp add"
>&lt;/p>
&lt;p>然后重启dhcp服务。&lt;/p>
&lt;h3 id="upnp">UPNP
&lt;/h3>&lt;p>开启ikuai的UPNP服务&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/884FC4595B931D9989209265CF9BA440.png"
loading="lazy"
alt="ikuai upnp"
>&lt;/p>
&lt;p>ikuai的设置基本已经设置完毕了。剩下的就是要接入互联网了。&lt;/p>
&lt;p>把光猫连在j4125机器的eth1上，路由器接到机器的eth3上来开启wifi，整个家庭的网络就已经通了。&lt;/p></description></item><item><title>畅网J4125安装Proxmox VE(PVE)8.0</title><link>https://www.iminling.com/2024/j4125-install-pve/</link><pubDate>Sat, 23 Mar 2024 09:15:47 +0000</pubDate><guid>https://www.iminling.com/2024/j4125-install-pve/</guid><description>&lt;p>年前综合考虑买了一台畅网的J4125，低功耗，也能满足一些搞机需求。由于一直忙于工作，一直没有时间研究它，最近终于抽空给机器装上了PVE8.0系统，记录一下折腾的过程。&lt;/p>
&lt;h2 id="机器配置">机器配置
&lt;/h2>&lt;p>畅网J4125&lt;/p>
&lt;div>
&lt;ul>
&lt;li>
英特尔®第十代Gemini Lake低功耗四核处理器
&lt;/li>
&lt;li>
4个Intel i226-V 2.5G网卡
&lt;/li>
&lt;li>
2条SO-DIMM DDR4 2400MHz（兼容2666/3200MHz）
&lt;/li>
&lt;li>
1个mSATA接口、1个SATA3.0硬盘接口
&lt;/li>
&lt;li>
1个HDMI 1.4接口支持4K（4096x2160@30Hz）
&lt;/li>
&lt;li>
1个DP 1.2接口支持4K（4096x2160@60Hz）
&lt;/li>
&lt;li>
4个USB 3.0
&lt;/li>
&lt;li>
全长miniPCle插槽支持USB信号的4G/WiFi通讯模块
&lt;/li>
&lt;li>
直流DC-12V 55*25输入或凤凰端子供电
&lt;/li>
&lt;li>
支持看门狗、GPIO、PXE无盘启动、网络唤醒
&lt;/li>
&lt;/ul>
&lt;p>
我这边是买了一个梵想的256G mSATA硬盘，另外买了两个三星8GB,3200HZ的内存条，整机的硬件算是完成。
&lt;/p>
&lt;/div>
&lt;h2 id="准备工作">准备工作
&lt;/h2>&lt;h3 id="u盘">U盘
&lt;/h3>&lt;p>安装PVE需要从U盘进行启动，这里使用&lt;a class="link" href="https://www.ventoy.net/cn/download.html" target="_blank" rel="noopener"
>ventory&lt;/a>来制作启动盘。电脑上插上需要制作启动盘的U盘，然后下载ventory解压后运行&lt;code>ventory2Disk.exe&lt;/code>，设备选择自己的U盘，安装就可以了。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/045CD2CA0832B0F536C60FD0A0CA5156.png"
loading="lazy"
alt="ventory"
>&lt;/p>
&lt;h3 id="pve下载">PVE下载
&lt;/h3>&lt;p>直接&lt;a class="link" href="https://pve.proxmox.com/wiki/Downloads" target="_blank" rel="noopener"
>PVE官网&lt;/a>进行下载，根据自己的情况下载，我这里下载的是8.0的版本。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/63848743FDBE6EBF831ABDD73BD3588A.png"
loading="lazy"
alt="pve download"
>&lt;/p>
&lt;p>把下载好的pve镜像放到上边制作好的U盘中。&lt;/p>
&lt;p>准备工作已完成。&lt;/p>
&lt;h2 id="安装pve">安装PVE
&lt;/h2>&lt;p>&lt;strong>安装的所有截图都来源于网络，因为安装的过程没办法截图，具体的ip地址请以文字中说明的为准。&lt;/strong>&lt;/p>
&lt;p>&lt;strong>网段是：192.168.1.xxx&lt;/strong>&lt;/p>
&lt;p>&lt;strong>网关：192.168.1.253&lt;/strong>&lt;/p>
&lt;p>&lt;strong>pve管理ip：192.168.1.251&lt;/strong>&lt;/p>
&lt;h3 id="网口规划">网口规划
&lt;/h3>&lt;p>机器有4个网口，ETH0、ETH1，ETH2，ETH3，我打算是让ETH3来作为管理端口，所以在后边安装的时候选择最后一个网口。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/B520565B40BE8AFD73DFF73909BD3765.png"
loading="lazy"
alt="j4125"
>&lt;/p>
&lt;h3 id="安装">安装
&lt;/h3>&lt;p>下边就可以开始安装pve了，机器通过HDMI连接到显示器，并连接键盘和鼠标。然后进行开机，我这台机器是按&lt;code>delete&lt;/code>键进入bios设置,在&lt;code>Boot&lt;/code>选项中选择&lt;code>Boot option #1&lt;/code>中选择上边制作的启动盘，然后F10保存重启。&lt;/p>
&lt;div id="attachment_464" style="width: 874px" class="wp-caption alignnone">
![bios](https://www.iminling.com/wp-content/uploads/2024/03/24959220BB5C4D43BDFF77B6BC32C837.png)
&lt;p id="caption-attachment-464" class="wp-caption-text">
图片来源网络
&lt;/p>
&lt;/div>
&lt;h4 id="模式选择">模式选择
&lt;/h4>&lt;p>开机后就进入了安装，选择第一个模式进行安装：&lt;/p>
&lt;div id="attachment_465" style="width: 870px" class="wp-caption alignnone">
![pve mode](https://www.iminling.com/wp-content/uploads/2024/03/DD7AE77B7444838AF56187A445C8791F.png)
&lt;p id="caption-attachment-465" class="wp-caption-text">
图片来源网络
&lt;/p>
&lt;/div>
&lt;h4 id="协议">协议
&lt;/h4>&lt;p>接下来就是同意协议：&lt;/p>
&lt;div id="attachment_466" style="width: 821px" class="wp-caption alignnone">
![agree](https://www.iminling.com/wp-content/uploads/2024/03/DD9704DAA2FE4EBB351F5C48BCF713D5.png)
&lt;p id="caption-attachment-466" class="wp-caption-text">
图片来源网络
&lt;/p>
&lt;/div>
&lt;h4 id="硬盘选择">硬盘选择
&lt;/h4>&lt;p>选择硬盘，选择自己的J4125机器中安装的硬盘，不要选择成了U盘。&lt;/p>
&lt;div id="attachment_467" style="width: 877px" class="wp-caption alignnone">
![pve disk](https://www.iminling.com/wp-content/uploads/2024/03/3AC2CEA586DFF17A88000A99D8531EB7.png)
&lt;p id="caption-attachment-467" class="wp-caption-text">
图片来源网络
&lt;/p>
&lt;/div>
&lt;h4 id="地区设置">地区设置
&lt;/h4>&lt;p>地区和时区以及键盘设置：&lt;/p>
&lt;div id="attachment_468" style="width: 884px" class="wp-caption alignnone">
![pve location](https://www.iminling.com/wp-content/uploads/2024/03/DB8C1DE45939E6E6B782ACA8AA505CDA.png)
&lt;p id="caption-attachment-468" class="wp-caption-text">
图片来源网络
&lt;/p>
&lt;/div>
&lt;h4 id="密码设置">密码设置
&lt;/h4>&lt;p>管理密码和邮箱设置,&lt;strong>密码在后边登录pve的时候要用到，请牢记。&lt;/strong>&lt;/p>
&lt;div id="attachment_469" style="width: 885px" class="wp-caption alignnone">
![pve password](https://www.iminling.com/wp-content/uploads/2024/03/AE66F722B994AE7DA8C3240787B763A7.png)
&lt;p id="caption-attachment-469" class="wp-caption-text">
图片来源网络
&lt;/p>
&lt;/div>
&lt;h4 id="网络设置">网络设置
&lt;/h4>&lt;p>接下来的就是重点了，需要指定pve的管理网口以及ip的一些信息&lt;/p>
&lt;div id="attachment_470" style="width: 865px" class="wp-caption alignnone">
![pve network](https://www.iminling.com/wp-content/uploads/2024/03/F3114AD0CCF85E1B749E1B5E2B7DD2EA.png)
&lt;p id="caption-attachment-470" class="wp-caption-text">
图片来源网络
&lt;/p>
&lt;/div>
&lt;p>假如我想让我家的所有设置的ip是&lt;code>192.168.1.xxx&lt;/code>开头,其中第三位的1可以替换为自己想要的网段，比如：&lt;code>192.168.31.xxx&lt;/code>(小米路由器就是用这个网段)&lt;/p>
&lt;p>详细说明一下这5个选项：&lt;/p>
&lt;p>管理接口：这里在上边也说了，我打算把管理接口放在ETH3，所以我这里选了最后一个：enp4s0.&lt;/p>
&lt;p>主机名称：这里可以不用处理，默认就行了。&lt;/p>
&lt;p>ip地址：这里的ip是等下在网页登录的地址，根据自己需求来指定，我自己的设置为&lt;code>192.168.1.251&lt;/code>,&lt;/p>
&lt;p>网关：这里是主路由的地址，比如我在安装pve后想要再装ikuai来拨号上网，并且ikuai的管理ip为：192.168.1.253，那么我这里的网关地址就填这个了。如果你后边的ikuai是其他的ip，替换为自己的。&lt;/p>
&lt;p>DNS服务器：填写和网关一样的地址就可以了。&lt;/p>
&lt;p>这里的网关如果填错了也没关系，后边在pve里也可以进行修改，如果填错最直接的表现就是pve没办法上网。这个我在折腾的过程中也遇到了。&lt;/p>
&lt;p>剩下的就是核对信息，然后进行安装了。等安装完成后会提示让重启。进行重启就可以了，&lt;strong>在重启的时候拔掉U盘&lt;/strong>，防止又从启动盘中进行了启动。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/91E2AEFE6037B5300C4F3ED953CC60AA.png"
loading="lazy"
alt="pve installed"
>&lt;/p>
&lt;h2 id="pve设置">PVE设置
&lt;/h2>&lt;p>上边安装pve后会进行重启，重启后会进入一个命令界面，需要输入账号和密码才能进入&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/7619FFCA83C5DE8958C507AF566F795F.png"
loading="lazy"
alt="pve login"
>&lt;/p>
&lt;p>这时候可以把机器连接到电脑，使用电脑通过网页端来设置pve了。正确的连接方式是：在安装过程中的管理端口连上网线，网线的另一端插入到电脑的网线口，并设置电脑端和pve在同一个网段（这个在上边安装的时候已经说明过），比如我的安装网段是192.168.1.xxx，pve管理ip是：192.168.1.251，那么设置电脑的网络为192.168.1.200就可以了。&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/822B49833AF1F444A36B271B3311E4C8.png"
loading="lazy"
alt="ip"
>&lt;/p>
&lt;p>设置好后就可以通过网页端访问ip：192.168.1.251:8006来访问了,如果提示不安全则点击高级继续访问：&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/CD93DD5C644478C4CE80F2A6A1FDDC62.png"
loading="lazy"
alt="access pve"
>&lt;/p>
&lt;p>然后输入用户名和密码进行登录，用户名：root，密码是在安装的时候输入的密码。就进入了pve的管理界面：&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/F280389CB4DACB73663BEEAC4F6D22F6.png"
loading="lazy"
alt="pve manage"
>&lt;/p>
&lt;h3 id="网口直通">网口直通
&lt;/h3>&lt;p>进入后首先需要设置的就是网口直通，进入pve的shell界面，修改/etc/default/grub文件，修改GRUB_CMDLINE_LINUX_DEFAULT=&amp;ldquo;quiet&amp;quot;为GRUB_CMDLINE_LINUX_DEFAULT=&amp;ldquo;quiet intel_iommu=on&amp;rdquo;&lt;/p>
&lt;p>&lt;img src="https://www.iminling.com/wp-content/uploads/2024/03/4C57D0FA5670811C19BE26E95DFB47BB.png"
loading="lazy"
alt="pve grub"
>&lt;/p>
&lt;p>然后执行&lt;code>update-grub&lt;/code>更新并重启：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">root@pve:~# vim /etc/default/grub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@pve:~# update-grub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generating grub configuration file ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Found linux image: /boot/vmlinuz-6.2.16-3-pve
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Found initrd image: /boot/initrd.img-6.2.16-3-pve
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Found memtest86+ 64bit EFI image: /boot/memtest86+x64.efi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Adding boot menu entry for UEFI Firmware Settings ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@pve:~# reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>进行到这里pve安装基本已经完成了，截止到现在pve还不可以上网，这个需要在进行爱快(ikuai)安装后，进行拨号上网让整个环境都有网络。后续在进行介绍。&lt;/p></description></item></channel></rss>