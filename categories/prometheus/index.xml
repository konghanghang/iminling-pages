<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Prometheus on 记录点滴 - 分享</title><link>https://konghanghang.github.io/iminling-pages/categories/prometheus/</link><description>Recent content in Prometheus on 记录点滴 - 分享</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>iminling.com</copyright><lastBuildDate>Sun, 26 Nov 2023 06:42:47 +0000</lastBuildDate><atom:link href="https://konghanghang.github.io/iminling-pages/categories/prometheus/index.xml" rel="self" type="application/rss+xml"/><item><title>安装node exporter监控linux主机各项指标</title><link>https://konghanghang.github.io/iminling-pages/2023/install-node-exporter/</link><pubDate>Sun, 26 Nov 2023 06:42:47 +0000</pubDate><guid>https://konghanghang.github.io/iminling-pages/2023/install-node-exporter/</guid><description>&lt;img src="https://images.iminling.com/app/hide.php?key=M3JOYmRIT1UyZHJjcTZJRXloNjR6aTUyME1KbkhNak8yVDlTVm9saGloSXUwWkNsN0VZSStxRGU1Q1ZTQS9xVzRuY0szTHM9" alt="Featured image of post 安装node exporter监控linux主机各项指标" />&lt;p>在上一篇文章中讲解了如何在docker环境下快速的安装prometheus：&lt;a class="link" href="https://konghanghang.github.io/iminling-pages/2023/debian-use-docker-install-promutheus/" >debian系统使用docker快速安装promutheus&lt;/a>，这篇文章咱们来讲一下如何在linux主机中安装node exporter来采集linux系统的各项指标。&lt;/p>
&lt;h2 id="安装node-exporter">安装node exporter
&lt;/h2>&lt;p>node exporter的安装非常简单，可以去prometheus的官网下载：&lt;a class="link" href="https://prometheus.io/download/" title="node exporter"
target="_blank" rel="noopener"
>node exporter - prometheus&lt;/a>，或者去github进行下载：&lt;a class="link" href="https://github.com/prometheus/node_exporter" title="node_exporter - github"
target="_blank" rel="noopener"
>node_exporter - github&lt;/a>，我这里直接使用wget命令从github上下载最新的安装包&lt;code>wget https://github.com/prometheus/node_exporter/releases/download/v1.2.2/node_exporter-1.2.2.linux-amd64.tar.gz&lt;/code>：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@admin:~# wget https://github.com/prometheus/node_exporter/releases/download/v1.2.2/node_exporter-1.2.2.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--2023-11-25 22:35:44-- https://github.com/prometheus/node_exporter/releases/download/v1.2.2/node_exporter-1.2.2.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resolving github.com &lt;span class="o">(&lt;/span>github.com&lt;span class="o">)&lt;/span>... 20.205.243.166
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to github.com &lt;span class="o">(&lt;/span>github.com&lt;span class="o">)&lt;/span>&lt;span class="p">|&lt;/span>20.205.243.166&lt;span class="p">|&lt;/span>:443... connected.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">HTTP request sent, awaiting response... &lt;span class="m">302&lt;/span> Found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Location: https://objects.githubusercontent.com/github-production-release-asset-2e65be/9524057/28598a7c-d8ad-483d-85ba-8b2c9c08cf57?X-Amz-Algorithm&lt;span class="o">=&lt;/span>AWS4-HMAC-SHA256&lt;span class="p">&amp;amp;&lt;/span>X-Amz-Credential&lt;span class="o">=&lt;/span>AKIAIWNJYAX4CSVEH53A%2F20231126%2Fus-east-1%2Fs3%2Faws4_request&lt;span class="p">&amp;amp;&lt;/span>X-Amz-Date&lt;span class="o">=&lt;/span>20231126T033542Z&lt;span class="p">&amp;amp;&lt;/span>X-Amz-Expires&lt;span class="o">=&lt;/span>300&lt;span class="p">&amp;amp;&lt;/span>X-Amz-Signature&lt;span class="o">=&lt;/span>cf09a0c524756802e669d7ccb2b60b9dcc5f3cfd0855cd9abad7d31947596c2f&lt;span class="p">&amp;amp;&lt;/span>X-Amz-SignedHeaders&lt;span class="o">=&lt;/span>host&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="nv">actor_id&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="nv">key_id&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="nv">repo_id&lt;/span>&lt;span class="o">=&lt;/span>9524057&lt;span class="p">&amp;amp;&lt;/span>response-content-disposition&lt;span class="o">=&lt;/span>attachment%3B%20filename%3Dnode_exporter-1.2.2.linux-amd64.tar.gz&lt;span class="p">&amp;amp;&lt;/span>response-content-type&lt;span class="o">=&lt;/span>application%2Foctet-stream &lt;span class="o">[&lt;/span>following&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--2023-11-25 22:35:45-- https://objects.githubusercontent.com/github-production-release-asset-2e65be/9524057/28598a7c-d8ad-483d-85ba-8b2c9c08cf57?X-Amz-Algorithm&lt;span class="o">=&lt;/span>AWS4-HMAC-SHA256&lt;span class="p">&amp;amp;&lt;/span>X-Amz-Credential&lt;span class="o">=&lt;/span>AKIAIWNJYAX4CSVEH53A%2F20231126%2Fus-east-1%2Fs3%2Faws4_request&lt;span class="p">&amp;amp;&lt;/span>X-Amz-Date&lt;span class="o">=&lt;/span>20231126T033542Z&lt;span class="p">&amp;amp;&lt;/span>X-Amz-Expires&lt;span class="o">=&lt;/span>300&lt;span class="p">&amp;amp;&lt;/span>X-Amz-Signature&lt;span class="o">=&lt;/span>cf09a0c524756802e669d7ccb2b60b9dcc5f3cfd0855cd9abad7d31947596c2f&lt;span class="p">&amp;amp;&lt;/span>X-Amz-SignedHeaders&lt;span class="o">=&lt;/span>host&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="nv">actor_id&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="nv">key_id&lt;/span>&lt;span class="o">=&lt;/span>0&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="nv">repo_id&lt;/span>&lt;span class="o">=&lt;/span>9524057&lt;span class="p">&amp;amp;&lt;/span>response-content-disposition&lt;span class="o">=&lt;/span>attachment%3B%20filename%3Dnode_exporter-1.2.2.linux-amd64.tar.gz&lt;span class="p">&amp;amp;&lt;/span>response-content-type&lt;span class="o">=&lt;/span>application%2Foctet-stream
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resolving objects.githubusercontent.com &lt;span class="o">(&lt;/span>objects.githubusercontent.com&lt;span class="o">)&lt;/span>... 185.199.108.133, 185.199.109.133, 185.199.111.133, ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to objects.githubusercontent.com &lt;span class="o">(&lt;/span>objects.githubusercontent.com&lt;span class="o">)&lt;/span>&lt;span class="p">|&lt;/span>185.199.108.133&lt;span class="p">|&lt;/span>:443... connected.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">HTTP request sent, awaiting response... &lt;span class="m">200&lt;/span> OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Length: &lt;span class="m">8898481&lt;/span> &lt;span class="o">(&lt;/span>8.5M&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>application/octet-stream&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Saving to: ‘node_exporter-1.2.2.linux-amd64.tar.gz’
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node_exporter-1.2.2.linux-amd64.tar.gz 100%&lt;span class="o">[===============================================================================&lt;/span>&amp;gt;&lt;span class="o">]&lt;/span> 8.49M 20.2MB/s in 0.4s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2023-11-25 22:35:46 &lt;span class="o">(&lt;/span>20.2 MB/s&lt;span class="o">)&lt;/span> - ‘node_exporter-1.2.2.linux-amd64.tar.gz’ saved &lt;span class="o">[&lt;/span>8898481/8898481&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>下载到本地主机后解压刚下载的文件，里边有三个文件，node_exporter就是我们需要的可执行文件：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@admin:~# tar -zxf node_exporter-1.2.2.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@admin:~# ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">images node_exporter-1.2.2.linux-amd64 node_exporter-1.2.2.linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@admin:~# &lt;span class="nb">cd&lt;/span> node_exporter-1.2.2.linux-amd64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@admin:~/node_exporter-1.2.2.linux-amd64# ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LICENSE node_exporter NOTICE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="运行node-exporter">运行node exporter
&lt;/h2>&lt;p>可以进入到&lt;code>node_exporter-1.2.2.linux-amd64&lt;/code>&lt;/p>
&lt;p>目录，执行&lt;code>./node_export&lt;/code>来执行项目，如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@admin:~/node_exporter-1.2.2.linux-amd64# ./node_exporter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2023-11-26T06:17:11.718Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>node_exporter.go:182 &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Starting node_exporter&amp;#34;&lt;/span> &lt;span class="nv">version&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;(version=1.2.2, branch=HEAD, revision=26645363b486e12be40af7ce4fc91e731a33104e)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2023-11-26T06:17:11.720Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>node_exporter.go:199 &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Listening on&amp;#34;&lt;/span> &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>:9100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2023-11-26T06:17:11.720Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>tls_config.go:191 &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;TLS is disabled.&amp;#34;&lt;/span> &lt;span class="nv">http2&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>从上边启动的日志可以看出采集的具体指标，倒数第二行日志可以看出node_exporter占用的是9100端口，如果我们想控制采集的指标或者更改占用端口，可以使用-h命令查看启动参数说明：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@admin:~/node_exporter-1.2.2.linux-amd64# ./node_exporter -h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --web.listen-address&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;:9100&amp;#34;&lt;/span> &lt;span class="c1"># 监听的端口，默认是9100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --web.telemetry-path&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;/metrics&amp;#34;&lt;/span> &lt;span class="c1"># metrics的路径，默认为/metrics&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --web.disable-exporter-metrics &lt;span class="c1"># 是否禁用go、prome默认的metrics&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --web.max-requests&lt;span class="o">=&lt;/span>&lt;span class="m">40&lt;/span> &lt;span class="c1"># 最大并行请求数，默认40，设置为0时不限制&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --log.level&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;info&amp;#34;&lt;/span> &lt;span class="c1"># 日志等级: [debug, info, warn, error, fatal]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --log.format&lt;span class="o">=&lt;/span>logfmt &lt;span class="c1"># 置日志打印target和格式: [logfmt, json]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --version &lt;span class="c1"># 版本号&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> --collector.&lt;span class="o">{&lt;/span>metric-name&lt;span class="o">}&lt;/span> &lt;span class="c1"># 各个metric对应的参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ......
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>具体的采集参数后续在使用的时候再详细研究，这里就先全部让它采集。以上边的方式启动是以前台运行的，我们关闭窗口程序就会自动退出，下边来配置systemd管理node_exporter.&lt;/p>
&lt;h2 id="配置node_exporterservices">配置node_exporter.services
&lt;/h2>&lt;p>首先把把解压后的node_exporter移动到/usr/local/bin目录下，然后新建一个node_exporter.service，需要建到/etc/systemd/system目录下，具体内容如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Unit&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Description&lt;/span>&lt;span class="o">=&lt;/span>node exporter service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Documentation&lt;/span>&lt;span class="o">=&lt;/span>https://prometheus.io
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">After&lt;/span>&lt;span class="o">=&lt;/span>network.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Service&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Type&lt;/span>&lt;span class="o">=&lt;/span>simple
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">User&lt;/span>&lt;span class="o">=&lt;/span>root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Group&lt;/span>&lt;span class="o">=&lt;/span>root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">ExecStart&lt;/span>&lt;span class="o">=&lt;/span>/usr/local/bin/node_exporter --web.listen-address&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;:9100&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">Restart&lt;/span>&lt;span class="o">=&lt;/span>on-failure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>Install&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">WantedBy&lt;/span>&lt;span class="o">=&lt;/span>multi-user.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如上所示，启动命令指定了启动的时候占用的端口，这个根据自己的实际情况进行更改，创建完毕后需要重启systemd服务，并使用systemd启动服务：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@admin:/usr/local/bin# systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@admin:/usr/local/bin# systemctl start node_exporter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@admin:/usr/local/bin# systemctl status node_exporter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">● node_exporter.service - node exporter service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Loaded: loaded &lt;span class="o">(&lt;/span>/etc/systemd/system/node_exporter.service&lt;span class="p">;&lt;/span> disabled&lt;span class="p">;&lt;/span> vendor preset: enabled&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Active: active &lt;span class="o">(&lt;/span>running&lt;span class="o">)&lt;/span> since Sun 2023-11-26 01:28:25 EST&lt;span class="p">;&lt;/span> 6s ago
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Docs: https://prometheus.io
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Main PID: &lt;span class="m">2794065&lt;/span> &lt;span class="o">(&lt;/span>node_exporter&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tasks: &lt;span class="m">4&lt;/span> &lt;span class="o">(&lt;/span>limit: 2358&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Memory: 4.7M
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CPU: 15ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CGroup: /system.slice/node_exporter.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └─2794065 /usr/local/bin/node_exporter --web.listen-address&lt;span class="o">=&lt;/span>:9100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nov &lt;span class="m">26&lt;/span> 01:28:25 WIKI-HK-A1 node_exporter&lt;span class="o">[&lt;/span>2794065&lt;span class="o">]&lt;/span>: &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2023-11-26T06:28:25.705Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>node_exporter.go:115 &lt;span class="nv">collector&lt;/span>&lt;span class="o">=&lt;/span>xfs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nov &lt;span class="m">26&lt;/span> 01:28:25 WIKI-HK-A1 node_exporter&lt;span class="o">[&lt;/span>2794065&lt;span class="o">]&lt;/span>: &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2023-11-26T06:28:25.705Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>node_exporter.go:115 &lt;span class="nv">collector&lt;/span>&lt;span class="o">=&lt;/span>zfs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nov &lt;span class="m">26&lt;/span> 01:28:25 WIKI-HK-A1 node_exporter&lt;span class="o">[&lt;/span>2794065&lt;span class="o">]&lt;/span>: &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2023-11-26T06:28:25.706Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>node_exporter.go:199 &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;Listening on&amp;#34;&lt;/span> &lt;span class="nv">address&lt;/span>&lt;span class="o">=&lt;/span>:9100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nov &lt;span class="m">26&lt;/span> 01:28:25 WIKI-HK-A1 node_exporter&lt;span class="o">[&lt;/span>2794065&lt;span class="o">]&lt;/span>: &lt;span class="nv">level&lt;/span>&lt;span class="o">=&lt;/span>info &lt;span class="nv">ts&lt;/span>&lt;span class="o">=&lt;/span>2023-11-26T06:28:25.706Z &lt;span class="nv">caller&lt;/span>&lt;span class="o">=&lt;/span>tls_config.go:191 &lt;span class="nv">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;TLS is disabled.&amp;#34;&lt;/span> &lt;span class="nv">http2&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>经过上述步骤就在需要被监控的linux主机上安装好了node exporter，接下来需要在prometheus中配置对该主机的指标进行抓取。&lt;/p>
&lt;h2 id="prometheus指标获取">prometheus指标获取
&lt;/h2>&lt;p>在文章：&lt;a class="link" href="https://konghanghang.github.io/iminling-pages/2023/debian-use-docker-install-promutheus/" >debian系统使用docker快速安装promutheus&lt;/a>中只配置了对promutheus本身指标的采集，下边我们修改prometheus的配置文件，对刚才配置的linux主机进行指标采集，修改prometheus的配置文件如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">global&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">scrape_interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">1m&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">scrape_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">job_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;prometheus&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">scrape_interval&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">1m&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">static_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">targets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;localhost:9090&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">job_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;linux-node&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">static_configs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">targets&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;127.0.0.1:9100&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如上，配置了一个任务名称为linux-node的任务，它去获取127.0.0.1机器的指标，我们可以在prometheus的后台查看到对应的targets:&lt;/p>
&lt;p>&lt;img src="https://images.iminling.com/app/hide.php?key=TzFEUWFRdXdmV3NWcURMSUxWRUdNN1pXSTRveHIrL0tueFpCVmNncnBHZ21GaTJlakJYQ2RuV3ZZd3FQeXFKb3hSd3Y2Q289"
loading="lazy"
>&lt;/p>
&lt;p>到这里就配置好了prometheus采集linux主机指标的配置，可以在prometheus的后台对信息进行查询，后续也可以配置grafana的图形界面来对node exporter采集的数据进行可视化展示。&lt;/p></description></item></channel></rss>