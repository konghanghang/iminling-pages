name: Hugo Build & Deploy via SSH

on:
  push:
    branches: [ master ]  # 或其他分支

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v4

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest'
          extended: true

    - name: Build Hugo site
      run: hugo --minify

    - name: Clear remote directory
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.DEPLOY_HOST }}
        port: ${{ secrets.SSH_PORT }}
        username: ${{ secrets.DEPLOY_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          rm -rf ${{ secrets.DEPLOY_PATH }}/*

    - name: Copy files via SCP
      uses: appleboy/scp-action@v0.1.7
      with:
        host: ${{ secrets.DEPLOY_HOST }}
        port: ${{ secrets.SSH_PORT }}
        username: ${{ secrets.DEPLOY_USER }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        source: "public/*"
        target: ${{ secrets.DEPLOY_PATH }}

